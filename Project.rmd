---
output:
  pdf_document: default
  html_document: default
  word_document: default
---

\pagenumbering{gobble}

---
title: 'Analysis of Prices of Dogs for Sale on Gumtree'
author: Shingyan Kwong, Roman Stepchyn, Gerald Mathias, Scarlett Groom-Ransom, Oliver
  Lountain
date: "October 27, 2017"
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(readxl)
library(broom)
setwd("~/Second Year/Stats/R_Directory")
gumtree <- read_excel("Gumtree_dogs.xlsx")
```

\centering
\raggedright
\newpage
\pagenumbering{arabic}
\tableofcontents
\newpage


# Introduction

In this project, using collected data on dog sales, a prediction of the price of a dog will be made. To be able to make such a prediction, a model will be selected that best fits the data. To select which predictor variables to use in the model and which to reject, three algorithms will be used: backwards, forwards, and stepwise selection. Before the model fitting can be performed, the data will be analyzed and generally cleaned to remove any potential sources of error in the model.


# Data Description

For this project, data was collected from the website gumtree.com.au. Using an algorithm, information was extracted from the sale listings and organized into variables. The variables that were used for this project were:


- The price of the dog for sale, in Australian dollars. This was the response variable.
- Whether the dog has been microchipped or not. This was one of the predictor variables.
- Whether the dog has been vaccinated or not. This was one of the predictor variables.
- Whether the dog has been desexed or not (entire). This was one of the predictor variables.
- Whether the dog is a crossbreed or not. This was one of the predictor variables.
- Whether the dog has been relinquished or not. This was one of the predictor variables.
- The dogâ€™s age in years. This was one of the predictor variables.
- What Australian state/territory the sale is being made from. This was one of the predictor variables.
- Who is offering the pet for sale (either owner or breeder). This was one of the predictor variables.


In total, 3450 sale data elements were collected from gumtree and 8 variables will be used to predict the price of a dog for sale. 



# Cleaning Data

First we will clean the values and variables by making sure all the values can  be interpreted by R and are able to be properly analysed.

### Price
The price variable contains string (character) inputs which need to be assigned to a numeric value and "NA" variables, of the character typle, which need to be set to the type of NA which can be interpreted by R so that it knows the data for that subject is unavailable.

The table of prices is shown below:

```{r}
table(gumtree$price)                         
# check if there are any NA
gumtree$price[gumtree$price == "NA"] <- NA  
# set all "NA" values to the NA anyway
```
  
R now understands which subjects have data, and the ones that do not have been set to NA. From here, we can check if it pass the stupidity test, in other that there words no dogs with negative values for price. The prices seem reasonable as there are dogs with minimum price of $0 and maximum price of $8000.  

```{r}
summary(gumtree$price)  
#View the summary statistics so far
```  

Next we check if price is a 'numeric' class.

```{r}
class(gumtree$price)   
#checking the class of variable price in gumtree data set

```
Price is a quantitiative variable so it should be converted to the numeric class.
  
```{r, error = FALSE, warning = FALSE}
gumtree$price <- as.numeric(gumtree$price)   #reset the class of Price to numeric so R knows these values are numbers
class(gumtree$price)

```

 
We then produce a histogram of the price data (Figure 1), the data appears to be reasonable, it will be described in the varaible description section. 


```{r, error = FALSE, warning = FALSE, message = FALSE, fig.cap = "Histogram of Prices of Dogs on Gumtree."}
ggplot(gumtree, aes(price)) +
  geom_histogram(col = "black", fill = "Light Blue")    #plot a histogram of dog ages
```


\newpage

### State

State is a categorical variable. We need to make sure R knows this is the case and reset string "NA"s to value NA. This make sure that R does not include that data in analysis.


```{r}
table(gumtree$state)
gumtree$state[gumtree$state=="NA"]<- NA
```

We now check the class of variable for state:

```{r}
class(gumtree$state)
```

Since it is a character, we convert it to the factor class of varaible:

```{r}
gumtree$state <- as.factor(gumtree$state)
```



### Cross
Cross is a catagorical variable. We need to make sure R treats it as a catagorical variable and to reset the string values of "NA" to the R value NA if there are any. This make sure that R does not include that data in analysis.

```{r}
table(gumtree$cross)                        
#Check the stauts of the values currently in R
gumtree$cross[gumtree$cross == "NA"] <- NA  
#Set all string "NA" values to the R value NA again
```

Next we check if cross is a factor variable. 

```{r}

class(gumtree$cross)                        
#Check the class of the variables
gumtree$cross <- as.factor(gumtree$cross)   
#set the class of the variable to factor again

```
Cross should be a categorical varaible, so it is changed to the factor class in R.

```{r}
class(gumtree$cross)
```

Now the data seems reasonable and it seem to pass the stupidity test, in other words it only takes two values, yes and no. As such, this data is considered to be cleaned.  

\newpage
  
### Pet offered by
'Pet Offered By:' is also a catagorical variable, so, as was the case for the cross data, we need to change the class to factor and change the "NA" values to the R recognisable NA values if there are any.
```{r}
table(gumtree$`Pet Offered By:`)
#Check the currnet status of the 'Pet Offered By:' values in R
gumtree$`Pet Offered By:`[gumtree$`Pet Offered By:` == "NA"] <- NA    
#Set al the string "NA" values to NA in R
```

Next we check if 'Pet Offered By' is a factor. 

```{r}
class(gumtree$`Pet Offered By:`)
#See what class"Pet Offered By:' is
gumtree$`Pet Offered By:` <- as.factor(gumtree$`Pet Offered By:`)
#set the class to factor 
```

Since it has the class, character, it is converted to the factor class.

```{r}
class(gumtree$`Pet Offered By:`)
```

We see no apparent anomalies in the 'Pet Offered By:' data, so we consider it cleaned. The data seems reasonable and it seem to pass the stupidity test, there are only 2 factors.

### Microchipping Status
The Microchipped variable is also a catagorical variable so same as above we need to change the class to factor and change the "NA" values to the R recognisable NA values.
```{r}
table(gumtree$micro)                          #Check the current microchipped data 
gumtree$micro[gumtree$micro == "NA"] <- NA
#set all the string "NA" values to NA in R
```
Next we check if micro is a factor. 
```{r}
class(gumtree$micro)                          #check what the class of michrochipped is
gumtree$micro <- as.factor(gumtree$micro)     #change the class of microchipped to factor***
#summary(gumtree$micro)                        #Observe our recent changes***
```

The microchipping status data is then changed to the factor class.

```{r}
class(gumtree$micro)
```

The Microchipped data looks reasonable so we consider it cleaned. The data seems reasonable and it seem to pass the stupidity test, the to possible values are microchipped or not microchipped. 

### Vaccination Status
The vaccinated variable is also a catagorical variable so same as above we need to change the class to factor and change the "NA" values to the R recognisable NA values.

```{r}
table(gumtree$vacc)                         #check the current vaccinated data
gumtree$vacc[gumtree$vacc == "NA"] <- NA    #change the string "NA" values to NA in R
```
Next we check if vaccinated is a factor, if it is, we do not need to make any changes.
```{r}
class(gumtree$vacc)                         #check the class of vaccinated
gumtree$vacc<-as.factor(gumtree$vacc)       #change the class to factor***
#table(gumtree$vacc)                         #Observe our recent changes***
```

We then change the class to factor.

```{r}
class(gumtree$vacc)
```

The vaccination status data looks ready to work with so we consider it cleaned.The data seems reasonable and it seem to pass the stupidity test, the entries are only either vaccincated or not vaccinated. 

### Desexing Status
The Desex variable is also a catagorical variable so same as above we need to change the class to factor and change the "NA" values to the R recognisable NA values.

```{r}
table(gumtree$desex)                          #check the current desex data 
gumtree$desex[gumtree$desex == "NA"] <- NA    #change the string "NA" to the NA in R
```

Next we check if desexing status is a factor, if it is, we do not need to make any changes.

```{r}
class(gumtree$desex)                          #Check the class of desex 
gumtree$desex<-as.factor(gumtree$desex)       #change the class to factor
#table(gumtree$desex)                          #Observe our recent changes***
```

We then change the class of variable to factor.

```{r}
class(gumtree$desex)
```

The Desex data is now clean. The data seems reasonable and it seem to pass the stupidity test, the data entries can take the values of desexed or entire.

### Relinquished Status

The Relinquished variable is also a catagorical variable so same as above we need to change the class to factor and change the "NA" values to the R recognisable NA values.
```{r}
table(gumtree$relinquished)                                 #check the current relinquished data
gumtree$relinquished[gumtree$relinquished == "NA"] <- NA    #change the string value of "NA" to NA R value
```
Next we check if relinquished status is a factor, if it is, we do not need to make any changes.
```{r}
class(gumtree$relinquished)                                 #check the class of relinquished
gumtree$relinquished <- as.factor(gumtree$relinquished)     #change the class of relinquished to factor
table(gumtree$relinquished)                                 #observe our recent changes
```

We then convert the variable class of relinquished to factor.

```{r}
class(gumtree$relinquished)
```

We see the relinquished data is clean and the data seems reasonable and it seem to pass the stupidity test, the data entries take the values of either yes or no.


### Age
The Age variable is a quantitative variable so we will need to change the class to numeric. The Age data also contains string "NA" values which will need to be changed to the NA value R recognises.

```{r, eval = FALSE}
table(gumtree$age)                        #check the current Age data
gumtree$age[gumtree$age == "NA"] <- NA    #change all "NA" values to the NA values R likes
class(gumtree$age)                        #check the class of age
gumtree$age <- as.numeric(gumtree$age)    #change the class to numeric
table(gumtree$age)                        #observe the recent changes
```

We will now do a stupidity test for the Age variable by plotting the values in a histogram to see if it seems reasonable.
  
```{r, error = FALSE, warning = FALSE, message = FALSE, fig.cap = "Histogram of Ages of Dogs on Gumtree."}
ggplot(gumtree, aes(age)) +
  geom_histogram(col = "black", fill = "Light Blue")    #plot a histogram of dog ages
```


\newpage

The histogram looks odd, so we check the summary statistics of age:
```{r}
summary(gumtree$age)    # check the summary statistics for the age data
```
As seen in the summary statistics, the min age for dogs is a negative number and the maximum age for dogs is 545.8 years old. This obviously does not pass the stupidity test, dogs can live for a while but not that long! We need to filter out the unreasonable ages of dogs so that they do not skew the data. We will remove any dogs age below 0 and above 25 years.

Since we have the go ahead from the researcher that these values are wrong, we will remove them from the dataset:

```{r, error = FALSE, warning = FALSE}
gumtree <- gumtree %>%
  filter(age>0, age<26)   #filter out the dogs with unreasonable ages less than 0 or greater than 25
```

Now we will check the age summary statistics again to see if everything is in order:
```{r}
summary(gumtree$age)    #Observe the age summary statistics 
```

These are much more reasonable values, and we consider the age variable cleaned.
Now we have completed all the cleaning of the data we can now start analysing it.

\newpage

# Variable Description

### Price

The variable Price is a quantitative random variable. It is continuous on the positive real number line.

#### Univariate plot
As Price is a quantitative continuous random variable, it can be shown on a histogram (Figure  3).


```{r, warning = FALSE, error = FALSE, message = FALSE, fig.cap = "Histogram of Price of dogs advertised on Gumtree in dollars."}
ggplot(gumtree,aes(x = price)) +
  geom_histogram(col = "black", fill = "Light Blue") +
  labs(x = "Price of dog in dollars.")
```



The random variable  Price appears to be unimodal and right skewed. The mean price of a dog on gumtree seems to be around the $250 to $500 range.

### Cross
The variable  cross is a categorical variable.

#### Univariate plot
As  cross is a categorical variable, it can be seen on the following bar-chart (Figure 4).


```{r, warning = F, error = F, fig.cap = "Bar Chart of Crossbreed Status of dogs advertised on Gumtree."}
ggplot(gumtree,aes(x = cross, fill = cross)) +
 geom_bar(fill = "Grey")+
 labs(x = "Crossbreed status of dog.")
```


It appears more purebred dogs are for sale on gumtree; approximately twice as many as there are crossbred dogs.


### State
The variable 'State' is categorical variable.

#### Univariate Plot
As state is a categorical variable, it is displayed on the following bar chart (Figure 5):


```{r, error = FALSE, warning = FALSE, fig.cap = "Bar Chart of State Data"}
ggplot(gumtree,aes(state))+
  geom_bar(fill = "Grey")+
  labs(x="state sold")+
  ggtitle("Bar Chart of State Data")
```

Here it can be seen that a large proportion of the dogs do not have any state data, this will be adressed when the data is analysed further.


### Pet offered by
The variable 'Pet Offered By:' is a categorical variable.

#### Univariate Plot
As  Pet Offered By is a categorical variable, it is shown on the following bar-chart (Figure 6):


```{r, warning = F, error = F, fig.cap = "Bar-Chart of who the pet is offered by on Gumtree."}
ggplot(gumtree, aes(x = `Pet Offered By:`, fill = `Pet Offered By:`)) +
  geom_bar(fill = "Grey")+
  labs(x = "Who is offering the pet for sale.")
```


The majority of dogs for sale on gumtree are offered by their owners.

### Microchipping Status
The variable  Microchip is a categorical variable.

#### Univariate plot
As  Microchip is a categorical variable, it can be seen on the following bar-chart (Figure 7).


```{r, warning = F, error = F, fig.cap = "Bar-Chart of how many dogs are Microchipped on Gumtree."}
ggplot(gumtree, aes(x = micro, fill = micro)) +
   geom_bar(fill = "Grey")+
   labs(x = "Status of dogs being microchipped.")
```


The majority of dog sale advertisements on gumtree do not specify whether the dog has been microchipped or not. But when information is provided, more than 90% of dogs for sale have been microchipped.

### Vaccination Status
The variable  Vaccination is a categorical variable.

#### Univariate plot
As  Vaccination is a categorical variable, it can be seen on the following bar-chart (Figure  8).


```{r, warning = F, error = F, fig.cap = "Bar-chart of how many dogs have been vaccinated on Gumtree."}
ggplot(gumtree, aes(x = vacc, fill = vacc)) +
   geom_bar(fill = "Grey")+
   labs(x = "Status of dogs being vaccinated.")
```

The majority of dog sale advertisements on gumtree do not specify whether the dog has been vaccinated or not. But when information is provided, more than 90% of dogs have been vaccinated.

### Desexing status
The variable  Desexing Status is a categorical variable.

#### Univariate plot
As  Desexing Status is a categorical variable, it can be visualised with a bar-chart (Figure 9).


```{r, warning = F, error = F, fig.cap = "Bar-Chart of how many dogs have been desexed on Gumtree."}
ggplot(gumtree, aes(x = desex, fill = desex)) +
   geom_bar(fill = "Grey")+
   labs(x = "Desex status of dogs.")
```


The majority of dog sale advertisements on gumtree do not specify whether the dog has been desexed. But when the information is provided, the majority of dogs have been desexed.

### Relinquished status
The variable  Relinquished Status is a categorical variable.

#### Univariate plot
As Relinquished Status is a categorical variable, it can be seen on the following bar-chart (Figure 10).


```{r, warning = F, error = F, fig.cap = "Bar-Chart of how many dogs have been relinquished on Gumtree."}
ggplot(gumtree, aes(x = relinquished, fill = relinquished)) +
   geom_bar(fill = "Grey")+
   labs(x = "Relinquished status of dogs.")
```


The majority of dogs for sale on gumtree have been relinquished.


### Age

The variable Age is a numerical variable taking integer values.

#### Univariate Plot
As age is a numerical variable, it is displayed on the following histogram (Figure 11):


```{r, warning = F, error = F, message = F, fig.cap = "Histogram of Age of Dogs on Gumtree."}
ggplot(gumtree,aes(x = age)) +
  geom_histogram(col = "black", fill = "Light Blue") +
  labs(x = "Age of Dogs.")
```


\newpage



# Bivariate Analysis

  
### Cross

Here, we produce a boxplot of dog prices sorted by cross (Figure 12):

```{r, warning = F, error = F, fig.cap = "Boxplots of dog prices on Gumtree sorted by cross."}
ggplot(gumtree, aes(x = cross, y = price)) + geom_boxplot()
```

#### Description

**Shape:**
The distribution of prices for dogs which are and are not been cross breeds appear to both be right-skeweed. Mean price seems to be slightly higher for breeds that are not crossed.

**Location:**
The centre of the data for dogs which are not been cross breeds is at a slightly higher price than those which are.

**Spread:**
Prices of dogs which have been cross bred have a slightly wider spread of data than those which have not.

**Outliers:**
Both dogs which are cross breeds and those which are not have a large number of more extreme prices which can be considered to be outliers.



### State
Here we produce a boxplot of dog prices sorted by the state in which they are being sold (FIgure 13):


```{r, warning = F, error = F, fig.cap = "Boxplots of the dog prices on Gumtree sorted by state."}
ggplot(gumtree, aes(x = state, y = price)) + geom_boxplot()
```

\newpage

Without NA values (Figure 14):



```{r, warning = F, error = F, fig.cap = "Boxplots of the dog prices on Gumtree sorted by state, without NA values."}
ggplot(gumtree %>% filter(!is.na(gumtree$state)), aes(x = state, y = price)) + geom_boxplot()
```


Again, we produce the same plot but against the natural logarithm of price, since the interquartile range spanned a small portion of the price axis when the outliers are considered (Figure 15):


```{r, warning = F, error = F, fig.cap = "Boxplots of the natural logarithm of dog prices on Gumtree sorted by state, without NA values."}
ggplot(gumtree %>% filter(!is.na(gumtree$state)), aes(x = state, y = log(price))) + geom_boxplot()
```


#### Description

**Shape:**
The distribution of prices of dogs seem to be mostly symmetrical in all states, except the prices in Victoria may be slightly right-skewed.

**Location:**
The centre of the data for dogs prices is very similar amongst all states.

**Spread:**
Most states have a similarly small spread of data, except Victoria which has a wider spread, and ACT and WA which both have narrower spreads.

**Outliers:**
All states appear to have a number of outliers, with the least extreme prices in Tasmania. Most outliers seem to be skewed towards a higher price.






### Pet Offered By

Here we produce a boxplot for pets offered by owners and those offered by breeders against the response variable price (Figure 16):


```{r, warning = F, error = F, fig.cap = "Boxplots of dog prices on Gumtree sorted by seller."}
ggplot(gumtree, aes(x = `Pet Offered By:`, y = price)) + geom_boxplot()
```


We then produce the same plot but against the natural logarithm of price, since the interquartile range spanned a small portion of the price axis when the outliers are considered (Figure 17).


```{r, warning = F, error = F, fig.cap = "Boxplots of the natural logarithm of dog prices on Gumtree sorted by seller."}
ggplot(gumtree, aes(x = `Pet Offered By:`, y = log(price))) + geom_boxplot()
```


#### Description

**Shape:**
Both seem to be symmetrical aside from outliers. breeder has a higher mean price compared to owner.

**Location:**
The data for dogs sold by breeders is centred at a higher price than those being sold by owners.

**Spread:**
There is a much wider range of prices of dogs sold by breeders than those sold by owners.

**Outliers:**
There are a number of outliers well above the majority of the prices for dogs sold by owners, most likely special breeds, and six outliers sold by breeders.


### Microchipping Status

Here we produce a boxplot for pets offered by owners and those offered by breeders against the response variable price (figure 18):


```{r, warning = F, error = F, fig.cap = "Boxplots of dog prices on Gumtree sorted by whether dogs have been microchipped."}
ggplot(gumtree, aes(x = micro, y = price)) + geom_boxplot()
```


We can now filter out the NA values (Figure 19).


```{r, warning = F, error = F, fig.cap = "Boxplots of dog prices on Gumtree sorted by whether dogs have been microchipped, without NA values."}
ggplot(gumtree %>% filter(!is.na(gumtree$micro)), aes(x = micro, y = price)) + geom_boxplot()
```


Again, we produce the same plot but against the natural logarithm of price, since the interquartile range spanned a small portion of the price axis when the outliers are considered (Figure 20).


```{r, warning = F, error = F, fig.cap = "Boxplots of the natural logarithm of dog prices on Gumtree sorted by whether dogs have been microchipped, without NA values."}
ggplot(gumtree %>% filter(!is.na(gumtree$micro)), aes(x = micro, y = log(price))) + geom_boxplot()
```

\newpage

#### Description

**Shape:**
Dogs which have been microchipped seem to have generally symmetrical data. Those which are not microchipped may be slightly right-skewed. Dogs that have been microchipped have a higher mean price compared to their counterpart.

**Location:**
The data for dogs which have been microchipped is centred at a slightly higher price than those which have not been microchipped, but there is some overlap.

**Spread:**
There is a much wider range of prices of dogs which have been microchipped than which have not been.

**Outliers:**
There is a large number of outliers for the dogs which have been microchiped. There are no outliers for the dogs which have not been microchipped.


### Vaccination Status
Now a boxplot is produced showing prices of dogs sorted by their vaccination status (Figure 21):


```{r, warning = F, error = F, fig.cap = "Boxplots of the dog prices on Gumtree sorted by whether dogs have been vaccinated."}
ggplot(gumtree, aes(x = vacc, y = price)) + geom_boxplot()
```

\newpage

Without NA values (Figure 22):


```{r, warning = F, error = F, fig.cap = "Boxplots of the dog prices on Gumtree sorted by whether dogs have been vaccinated, without NA values."}
ggplot(gumtree %>% filter(!is.na(gumtree$vacc)), aes(x = vacc, y = price)) + geom_boxplot()
```


Again, we produce the same plot but against the natural logarithm of price, since the interquartile range spanned a small portion of the price axis when the outliers are considered (Figure 23).


```{r, warning = F, error = F, fig.cap = "Boxplots of the natural logarithm of dog prices on Gumtree sorted by whether dogs have been vaccinated, without NA values."}
ggplot(gumtree %>% filter(!is.na(gumtree$vacc)), aes(x = vacc, y = log(price))) + geom_boxplot()
```

\newpage

#### Description

**Shape:**
Both dogs which have, and which have not been vaccinated appear to have symmetrical data, however, since those which have not, have such a narrow spread, (possibly due to a small sample size) it is difficult to be certain. Vaccinated dogs have a higher mean price.

**Location:**
The centre of the data for dogs which have not been vaccinated is at a lower price than those which have.

**Spread:**
Those which have been vaccanited have a reasonably small spread apart from outliers, and those which have not been vaccinated have a very small spread.

**Outliers:**
The non-vaccinated dogs appear to have one outlier either side of the centre, and the dogs which have been vaccinated have a larger number of oultiers at prices much higher than the centre of the data.


### Desexing Status
Here a boxplot is produced showing the prices of dogs sorted by their desexing status (Figure 24):


```{r, warning = F, error = F, fig.cap = "Boxplots of the dog prices on Gumtree sorted by whether dogs have been desexed."}
ggplot(gumtree, aes(x = desex, y = price)) + geom_boxplot()
```

\newpage

Without NA values (Figure 25):


```{r, warning = F, error = F, fig.cap = "Boxplots of the dog prices on Gumtree sorted by whether dogs have been vaccinated, without NA values."}
ggplot(gumtree %>% filter(!is.na(gumtree$desex)), aes(x = desex, y = price)) + geom_boxplot()
```


Again, we produce the same plot but against the natural logarithm of price, since the interquartile range spanned a small portion of the price axis when the outliers are considered (Figure 26).


```{r, warning = F, error = F, fig.cap = "Boxplots of the natural logarithm of dog prices on Gumtree sorted by whether dogs have been desexed, without NA values."}
ggplot(gumtree %>% filter(!is.na(gumtree$desex)), aes(x = desex, y = log(price))) + geom_boxplot()
```

\newpage

#### Description

**Shape:**
The prices of dogs which have been desexed appears to be symmetrically distributed, while the prices of those which are entire appears to be somewhat right-skewed. Mean price of dogs is slightly higher for dogs which are entire.

**Location:**
The data for the dogs which have not been desexed is centred a slightly higher price than those which have been desexed, but the difference is only approximately $100.

**Spread:**
The range of prices for the entire dogs is significantly larger than that for the desexed gods, which have quite a narrow spread.

**Outliers:**
There are a number of outliers in the prices of dogs which have been desexed, whereas there are only two outliers in the prices of dogs which have not been desexed.

  

### Relinquished Status
Now, a boxplot is produced showing the prices of dogs sorted by their relinquished status (Figure 27):


```{r, warning = F, error = F, fig.cap = "Boxplots of the dog prices on Gumtree sorted by whether dogs have been relinquished."}
ggplot(gumtree, aes(x = relinquished, y = price)) + geom_boxplot()
```


Again, we produce the same plot but against the natural logarithm of price, since the interquartile range spanned a small portion of the price axis when the outliers are considered (Figure 28):


```{r, warning = F, error = F, fig.cap = "Boxplots of the natural logarithm of dog prices on Gumtree sorted by relinquished."}
ggplot(gumtree %>% filter(!is.na(gumtree$state)), aes(x = relinquished, y = log(price))) + geom_boxplot()
```

\newpage

#### Description

**Shape:**
The distribution of prices for dogs which have and have not been relinquished appear to both be approximately symmetrical. Mean price is slightly higher for dogs which have not been relinquished.

**Location:**
The centre of the data for dogs which have not been relinquished is at a slightly higher price than those which have.

**Spread:**
Both those dogs which have and which have not been relinquished have a similarly narrow spread of prices.

**Outliers:**
Both dogs which have been relinquished and those which have not have a large number of more extreme prices which can be considered to be outliers.


### Age
As age is a numerical varaible, prices are plotted against age on the following boxplot (Figure 29):


```{r, warning = F, error = F, fig.cap = "Scatterplot of the dog prices of Gumtree against the age of the dog."}
ggplot(gumtree, aes(x = age, y = price)) + geom_point()
```

\newpage

#### Description

**Linearity:**
The relationship between age and price does not seem to be at all linear.

**Direction**
The relationship appears to be negative (higher age corresponds to lower prices).

**Strength**
There is a large spread of data, so the strength of the relationship is weak to moderate.


Since the data does not appear at all linear, we can produce the same plot but with the natural logarithm of price (Figure 30):


```{r, warning = F, error = F, fig.cap = "Scatterplot of the natural logarithm of dog prices of Gumtree against the age of the dog."}
ggplot(gumtree, aes(x = age, y = log(price))) + geom_point()
```


\newpage

# Model Fitting

We  define a version of the gumtree dataset (gumtreeN) without NA values in order to create our linear model.
```{r}

gumtreeN <- na.omit(gumtree)
gumtreeN <- filter(gumtreeN, price >10)

```

First, we create bivariate regression models of price against each predictor variable, to decide whether they have enough of an effect on price individually, and if not, they will not be considered for the final model. For this initial selection process, we use a more relaxed significance level of 0.1, before during model selection, where the stricter significance level of 0.05 is used.

Modelling against age:

```{r}
age.lm <- lm(price ~ age, data = gumtreeN)
glance(age.lm)
```

The p-value is less than the significance level of 0.1, hence the age data should be considered for the final model.

Modelling against cross:

```{r}
cross.lm <- lm(price ~ cross, data = gumtreeN)
glance(cross.lm)
```

The p-value is less than the significance level of 0.1, hence the cross data should be considered for the final model.

Modelling against microchipping status:

```{r}
table(gumtreeN$micro)
```

Here we notice that there are no not microchipped dogs in the cleaned dataset, so the microchipping data should not be included in the final model


Modelling against vaccination:

```{r}
table(gumtreeN$vacc)
```

Here we notice that there are no unvaccinated dogs in the cleaned dataset, so the vaccination status data should not be included in the final model

Modelling against desexing status:

```{r}
desex.lm <- lm(price ~ desex, data = gumtreeN)
glance(desex.lm)
```

The p-value is less than the significance level of 0.1, hence the desexing status data should be considered for the final model.

Modelling against whether or not the dog is relinquished:

```{r}
relinquished.lm <- lm(price ~ relinquished, data = gumtreeN)
glance(relinquished.lm)
```

The p-value is less than the significance level of 0.1, hence the relinquished data should be considered for the final model.

Modelling against the state in which state the dog is being sold:

```{r}
state.lm <- lm(price ~ state, data = gumtreeN)
glance(state.lm)
```

The p-value is greater than the significance level of 0.1, hence the state data need not be considered for the final model.


### Model Selection


First, we create full and smallest versions of the model to indicate the scope, or rather, the most and least detailed versions of the model:
```{r, echo = TRUE}

full <-  price ~ (age + cross + desex + relinquished)^2
smallest <- price ~ 1

```
Here, only the variables which were shown to be statistically significant in the previous section, were included in the full model.


Next, three different algorithms will be used to determine the model, and the results will be compared in order to decide upon the final model:

First, the backwards selection method is used:

```{r, include = FALSE}
bM <- lm(full, data = gumtreeN)
bM <- step(bM, direction = "backward")
```

```{r}
tidy(bM)
```

Next, the forwards selection method is used:
```{r, include = FALSE}
fM <- lm(smallest, data = gumtreeN)
fM <- step(fM, scope = full, direction = "forward")
```

```{r}
tidy(fM)
```

Finally, the stepwise selection method is used:
```{r, include = FALSE}
sM <- lm(smallest, data = gumtreeN)
sM <- step(sM, scope = full, direction = "both")
```

```{r}
tidy(sM)
```

Here are our 3 models. Notice that they are basically the same model. Age:Cross and Cross:Age interactions terms are essentially the same.  

```{r}
list(backwards = bM,
     forwards = fM,
     step = sM) %>%
  map_df(broom::tidy, .id = "Model") %>%
  select(Model, term, estimate) %>%
  spread(Model, estimate)
```

We weill define this final model as test_model.

```{r}
test_model<-sM
glance(test_model)
```

Since the automatic selection method was used, heuristic decisions were made for us using the AIC.

Let's check our assumptions for this model in the following diagnostic plots (Figure 31):


```{r, warning = F, message = F, error = F, fig.cap = "Diagnostic Plots for Standard Model."}
tmp<-par(mfrow=c(2,2))
plot(test_model)
```


**Linearity:** Checking the residual vs fitted plot.  If assumption is true we expect the red line to be flat around 0. We see that there is a bit of curvature but it's not too bad. Hence linearity is reasonable. 

**Normality:** Checking the normal Quantile-Quantile plot. If the assumption is true we expect the points between -2 and 2 to fall on the diagonal line. We see that most points fall on the diagonal although some points curve upward around 2. Normality is okay. 

**Equal variance:** Check scale location plot. Looking for even spread as we go left to right.Points seem to fan outward as you go from left to right. Equal variance is not reasonable. 

**Independence:** Plots do not help us to discern independence of the tests. Price of dogs should theoretically be independent. 

Notice in the residual vs fitted plot, the points tend to be clustered to the left. This suggests that data is right skewed. Perhaps we can get a better model with a log transform of price. We apply the 3 algorithms we used previously.



### Logarithm of Price

Now, since the assumptions of the linear model were not satisfied well by the first model, we create bivariate regression models of log(price) against each predictor variable, to decide whether they have enough of an effect on log(price) individually, and if not, they will not be considered for the final model. Again, for this initial selection process, we use a more relaxed significance level of 0.1, before during model selection, where the stricter significance level of 0.05 is used.

Modelling against age:
  
```{r}
log_age.lm <- lm(log(price) ~ age, data = gumtreeN)
glance(log_age.lm)
```
The p-value is less than the significance level of 0.1, hence the age data should be considered for the final logarithm model.

Modelling against cross:
  
```{r}
log_cross.lm <- lm(log(price) ~ cross, data = gumtreeN)
glance(log_cross.lm)
```
The p-value is less than the significance level of 0.1, hence the cross data should be considered for the final logarithm model.

Modelling against microchipping status:
  
As was discovered for the first model, there are no dogs which have not been microchipped in the cleaned data, so it will not be considered for the logarithm of price model.

Modelling against vaccination:
  
As was discovered for the first model, there are no dogs which have not been vaccinated in the cleaned data, so it will not be considered for the logarithm of price model.

Modelling against desexing status:
  
```{r}
log_desex.lm <- lm(log(price) ~ desex, data = gumtreeN)
glance(log_desex.lm)
```

The p-value is less than the significance level of 0.1, hence the desexing status data should be considered for the final logarithm model.

Modelling against whether or not the dog is relinquished:
  
```{r}
log_relinquished.lm <- lm(log(price) ~ relinquished, data = gumtreeN)
glance(log_relinquished.lm)
```

The p-value is greater than the significance level of 0.1, hence the relinquished data should be considered for the final logarithm model.

Modelling against the state in which state the dog is being sold:
  
```{r}
log_state.lm <- lm(log(price) ~ state, data = gumtreeN)
glance(log_state.lm)
```

The p-value is greater than the significance level of 0.1, hence the state data need not be considered for the final logarithm model.




Backward Model:

```{r, include = FALSE}
  log_full <-  log(price) ~ (age + cross + desex + relinquished)^2
  smallest <- log(price) ~ 1
  
  log_bM <- lm(log_full, data = gumtreeN)
  log_bM <- step(log_bM, direction = "backward")
```

```{r}
  tidy(log_bM)
```

Forward Model: 
```{r, include = FALSE}
  log_fM <- lm(log_full, data = gumtreeN)
  log_fM <- step(log_bM, direction = "forward")
```

```{r}
  tidy(log_bM)
```

Stepwise Model:

```{r, include = FALSE}
  log_sM <- lm(log_full, data = gumtreeN)
  log_sM <- step(log_bM, direction = "both")
```

```{r}
  tidy(log_bM)
```

Let's put the 3 models next to each other. Notice that they are the same.

```{r}
list(backwards = log_bM,
     forwards = log_fM,
     step = log_sM) %>%
  map_df(broom::tidy, .id = "Model") %>%
  select(Model, term, estimate) %>%
  spread(Model, estimate)
```

We will call this model log_model.

```{r}
log_model<-log_sM
glance(log_model)
```

Since the automatic selection method was used, heuristic decisions were made for us using the AIC.

Let's check our assumptions in the following diagnostic plots (Figure 32):


```{r, error = F, warning = F, message = F, fig.cap = "Diagnostic Plots for Logarithm of Price Model."}
tmp<-par(mfrow=c(2,2))
plot(log_model)

```

**Linearity:** Check residual vs fitted plot.  If assumption is true we expect the red line to be flat around 0. We see that there is a bit of curvature but it's not too bad. Hence linearity is reasonable. 

**Normality:** Check normal QQ plot. If assumption is true we expect the points between -2 and 2 to fall on the diagonal line. We see that most points fall on the diagonal. Normality is okay and much better than previous model. 

**Constant variance:** Check scale location plot. Looking for even spread as we go left to right.Some curvature is seen but is not too bad. Better than previous model. Equal variance is okay.

**Independence:** Plots do not help. Price of dogs should theoretically be independent. 

Given that the 4 assumptions are okay and the plots for the log model look better, we choose to use the log model. 

\newpage

# Prediction

We were asked to predict the price of a South Australian, cross-breed dog that is 1 year old. The dog is vaccinated, desexed and unfortunately has to be re-homed because the owner is moving interstate. We will use our log model which only uses the predictors, age, cross, desex and relinquished. 

```{r}
predict(log_bM, data.frame(state = "SA", cross = "yes", age = 1, vacc = "vaccinated",
                       relinquished = "yes", desex = "Desexed",
                       micro = "microchipped"), interval = "predict")
```

Based on our model the log price of the dog is 4.571763. 

```{r}
exp(4.571763)
```

Hence the predicted price for this dog is $96.71. That is to say our model predicts that the median price for a dog with the traits described above is $96.71. 


# Conclusion

After cleaning the data, the bivariate analysis was performed. For each boxplot analysed, it was confirmed that the shape, location, spread and outliers all passed the â€˜stupidity testâ€™. Then, bivariate regression models were created of price against each predictor variable. Using these models, it was decided that the variables that had the biggest effect on price were:


- the age of the dog â€“ a negative effect on the price;
- the age and desexed status of the dog  â€“ a positive effect if the dog has not been desexed;
- the crossbreed status of the dog â€“ an extremely negative effect on the price if the dog is a crossbreed;
- the crossbreed status and relinquished status of the dog â€“ a positive effect if both are true;
- the desexed status of the dog â€“ a negative effect if false (entire);
- the relinquished status of the dog â€“ a very negative effect if true.


The four assumptions were checked for this proposed model and the assumption of equal variance was not reasonable. An attempt to improve the model was then performed; â€˜log(price)â€™ was used instead of â€˜priceâ€™. After checking the four assumptions for this modified model, all of the assumptions were reasonable. This was the final model chosen for prediction. The price of a South Australian, vaccinated, desexed, re-homed, cross-breed dog that is 1 year old was predicted using the model. The price was predicted to be: $96.71.



&nbsp;

&nbsp;

**Reference:**

All code for this paper is openly available on github. The relevant code can be found in the .rmd document.

https://github.com/Noramia/Gumtree-dogs
