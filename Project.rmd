---
output:
  html_document: default
  pdf_document: default
---

\pagenumbring{gobble}

---
title: 'A look into gumtree dogs analysis '
author: Shingyan Kwong, Roman Stepchyn, Gerald Mathias, Scarlett Groom-Ransom, Oliver
  Lountain
date: "October 15, 2017"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(readxl)
library(broom)
#remove the hex below once 
#setwd("~/Second Year/Stats/R_Directory")
gumtree <- read_rds("2.gumtree.rds")
```

\centering
\raggedright
\newpage
\pagenumbring{arabic}
\tableofcontents
\newpage


# Cleaning Data

First we will clean the values and variables by making sure all the values can  be interpreted by R and able to be properly analysed.

### Price
The price variable contains string inputs which need to be assigned to a numeric value and "NA" variables need to be set to the NA if there are any so that R can interpret so that it knows the data for that subject is unavailable.

```{r}
table(gumtree$price)                         
# check if there are any NA
gumtree$price[gumtree$price == "NA"] <- NA  
# set all "NA" values to the NA anyway
```
  
Now R understands which subjects have data, and the ones that don't have been set to NA. From here, we can check if it pass the stupidity test, i.e. no dogs with negative value and unreasonable amount. The prices seem reasonable as there are dogs with minimumu price of 0 and maximum price of 8000.  

```{r}
summary(gumtree$price)  
#View the summary statistics so far
```  
Next we check if price is a 'numeric' class.

```{r}
class(gumtree$price)   
#checking the class of variable price in gumtree data set

```
R considers Price to be of class 'numeric'. We do not need to chance class since Price is a quantitative variable. 
  
```{r}
gumtree$price <- as.numeric(gumtree$price)   #reset the class of Price to numeric so R knows these values are numbers
class(gumtree$price)

```

 

```{r}
ggplot(gumtree, aes(price)) +
  geom_histogram(col = "black", fill = "Light Blue")  
#plot of the price variable
```

  The random variable price appears to be unimodal and right skewed.
  
### State

State is a categorical variable. We need to make sure R knows this is the case and reset string "NA"s to value NA. This make sure that R does not include that data in analysis.

```{r}
table(gumtree$state)
gumtree$state[gumtree$state=="NA"]<- NA
class(gumtree$state)
gumtree$state <- as.factor(gumtree$state)
```

```{r}
ggplot(gumtree,aes(state))+
  geom_bar()+
  labs(x="state sold")+
  ggtitle("Bar chart of state")
```




### Cross
Cross is a categorical variable. We need to make sure R treats it as a catagorical variable and to reset the string values of "NA" to the R value NA if there are any. This make sure that R does not include that data in analysis.

```{r}
table(gumtree$cross)                        
#Check the stauts of the values currently in R
gumtree$cross[gumtree$cross == "NA"] <- NA  
#Set all string "NA" values to the R value NA again
```
Next we check if cross is a factor. 
```{r}

class(gumtree$cross)                        
#Check the class of the variables
gumtree$cross <- as.factor(gumtree$cross)   
#set the class of the variable to factor again

```
Since cross is a factor, we do not need to change the class. Now the data seems reasonable and it seem to pass the stupidity test, there are only yes and no factors and nothign else. This data is cleaned.  
  
### Pet offered by
'Pet Offered By:' is also a catagorical variable so same as above we need to change the class to factor and change the "NA" values to the R recognisable NA values if there are any.
```{r}
table(gumtree$`Pet Offered By:`)
#Check the currnet status of the 'Pet Offered By:' values in R
gumtree$`Pet Offered By:`[gumtree$`Pet Offered By:` == "NA"] <- NA    
#Set al the string "NA" values to NA in R
```
Next we check if 'Pet Offered By' is a factor. 
```{r}
class(gumtree$`Pet Offered By:`)
#See what class"Pet Offered By:' is
gumtree$`Pet Offered By:` <- as.factor(gumtree$`Pet Offered By:`)
#set the class to factor 
```

We see no apparent anomalies in the 'Pet Offered By:' data, so we consider it cleaned. The data seems reasonable and it seem to pass the stupidity test, there are only 2 factors.

### Microchipping Status
The Microchipped variable is also a catagorical variable so same as above we need to change the class to factor and change the "NA" values to the R recognisable NA values.
```{r}
table(gumtree$micro)                          #Check the current microchipped data 
gumtree$micro[gumtree$micro == "NA"] <- NA
#set all the string "NA" values to NA in R
```
Next we check if micro is a factor, if it is, we do not need to make any changes. 
```{r}
class(gumtree$micro)                          #check what the class of michrochipped is
gumtree$micro <- as.factor(gumtree$micro)     #change the class of microchipped to factor***
#summary(gumtree$micro)                        #Observe our recent changes***
```
The Microchipped data looks reasonable so we consider it cleaned. The data seems reasonable and it seem to pass the stupidity test, there are only either microchipped or not microchipped. 

### Vaccination Status
The vaccinated variable is also a catagorical variable so same as above we need to change the class to factor and change the "NA" values to the R recognisable NA values.

```{r}
table(gumtree$vacc)                         #check the current vaccinated data
gumtree$vacc[gumtree$vacc == "NA"] <- NA    #change the string "NA" values to NA in R
```
Next we check if vaccinated is a factor, if it is, we do not need to make any changes.
```{r}
class(gumtree$vacc)                         #check the class of vaccinated
gumtree$vacc<-as.factor(gumtree$vacc)       #change the class to factor***
#table(gumtree$vacc)                         #Observe our recent changes***
```
The vaccinated data looks ready to work with so we consider it cleaned.The data seems reasonable and it seem to pass the stupidity test, there are only either vaccincated or not vaccinated. 

### Desexing Status
The Desex variable is also a catagorical variable so same as above we need to change the class to factor and change the "NA" values to the R recognisable NA values.

```{r}
table(gumtree$desex)                          #check the current desex data 
gumtree$desex[gumtree$desex == "NA"] <- NA    #change the string "NA" to the NA in R
```
Next we check if desexing status is a factor, if it is, we do not need to make any changes.
```{r}
class(gumtree$desex)                          #Check the class of desex 
gumtree$desex<-as.factor(gumtree$desex)       #change the class to factor
#table(gumtree$desex)                          #Observe our recent changes***
```
The Desex data is now clean. The data seems reasonable and it seem to pass the stupidity test, there are only either desex or entire.

### Relinquished Status

The Relinquished variable is also a catagorical variable so same as above we need to change the class to factor and change the "NA" values to the R recognisable NA values.
```{r}
table(gumtree$relinquished)                                 #check the current relinquished data
gumtree$relinquished[gumtree$relinquished == "NA"] <- NA    #change the string value of "NA" to NA R value
```
Next we check if relinquished status is a factor, if it is, we do not need to make any changes.
```{r}
class(gumtree$relinquished)                                 #check the class of relinquished
gumtree$relinquished <- as.factor(gumtree$relinquished)     #change the class of relinquished to factor
table(gumtree$relinquished)                                 #observe our recent changes
```
We see the relinquished data is clean and the data seems reasonable and it seem to pass the stupidity test, there are only either yes or no.


### Age
The Age variable is a quantitative variable so we will need to change the class to numeric. The Age data also contains string "NA" values which will need to be changed to the NA value R recognises.

```{r, eval = FALSE}
table(gumtree$age)                        #check the current Age data
gumtree$age[gumtree$age == "NA"] <- NA    #change all "NA" values to the NA values R likes
class(gumtree$age)                        #check the class of age
gumtree$age <- as.numeric(gumtree$age)    #change the class to numeric
table(gumtree$age)                        #observe the recent changes
```

We will now do a stupidity test for the Age variable by plotting the values in a histogram to see if it seems reasonable.
  
```{r}
ggplot(gumtree, aes(age)) +
  geom_histogram(col = "black", fill = "Light Blue")    #plot a histogram of dog ages
```
  The histogram doesn't look how it's supposed to so we check the sumary of the age data
***we can just use the sumamry instead of the histogram.
```{r}
summary(gumtree$age)    # check the summary statistics for the age data
```
As seen in the summary statistics, the min age for dogs is a negative number and the maximum age for dogs is 545.8 years old. This obviously does not pass the stupidity test, dogs can live for a while but not that long! We need to filter out the unreasonable ages of dogs so that they do not skew the data. We will remove any dogs age below 0 and above 25 years.

Since we have the go ahead from the researcher that these values are wrong, we will remove them from the dataset:

```{r}
gumtree <- gumtree %>%
  filter(age>0, age<26)   #filter out the dogs with unreasonable ages less than 0 or greater than 25
```

Now we will check the age summary statistics again to see if everything is in order:
```{r}
summary(gumtree$age)    #Observe the age summary statistics 
```

These are much more reasonable values, and we consider the age variable cleaned.
Now we have completed all the cleaning of the data we can now start analysing it.



# Variable Description

### Price

The variable Price is a quantitative random variable. It is continuous on the positive real number line.

#### Univariate plot
As Price is a quantitative continuous random variable, it can be visualised with a histogram (Fig. 1).
```{r, warning = FALSE, error = FALSE, message = FALSE, fig.cap = "Histogram of price of advertised dogs on gumtree in dollars."}
ggplot(gumtree,aes(x = price)) +
  geom_histogram(ccol = "black", fill = "Light Blue") +
  labs(x = "Price of dog in dollars.")
```

The random variable  Price appears to be unimodal and right skewed. The mean price of a dog on gumtree seems to be around the $250 to $500 range.

### Cross
The variable  cross is a categorical variable.

#### Univariate plot
As  cross is a categorical variable, it can be visualised with a bar-chart.
```{r, warning = F, error = F, fig.cap = "Figure 2: Bar Chart of crossbreed status of advertised dogs on gumtree."}
ggplot(gumtree,aes(x = cross, fill = cross)) +
 geom_bar()+
 labs(x = "Crossbreed status of dog.")
```

It appears more purebred dogs are for sale on gumtree; approximately twice as many as there are crossbred dogs.

### Pet offered by
The variable 'Pet Offered By:' is a categorical variable.

#### Univariate plot
As  Pet Offered By is a categorical variable, it can be visualised with a bar-chart (Fig 3).
```{r, warning = F, error = F, fig.cap = "Figure 3: Bar-Chart of who is the pet offered by on gumtree."}
ggplot(gumtree, aes(x = `Pet Offered By:`, fill = `Pet Offered By:`)) +
  geom_bar()+
  labs(x = "Who is offering the pet for sale.")
```

\begin{center}
Figure number stuff to check that it works
\end{center}


The majority of dogs for sale on gumtree are offered by their owners.

### Microchipping Status
The variable  Microchip is a categorical variable.

#### Univariate plot
As  Microchip is a categorical variable, it can be visualised with a bar-chart (Fig. 4).
```{r, warning = F, error = F, fig.cap = "Figure 4: Bar-Chart of how many dogs are Microchipped on gumtree."}
ggplot(gumtree, aes(x = micro, fill = micro)) +
   geom_bar()+
   labs(x = "Status of dogs being microchipped.")
```

The majority of dog sale ads on gumtree do not specify whether the dog has been microchipped or not. But when information is provided, more than 90% of dogs for sale have been microchipped.

### Vaccination Status
The variable  Vaccination is a categorical variable.

#### Univariate plot
As  Vaccination is a categorical variable, it can be visualised with a bar-chart (Fig. 5).
```{r, warning = F, error = F, fig.cap = "Figure 5: Bar-chart of how many dogs have been vaccinated on gumtree."}
ggplot(gumtree, aes(x = vacc, fill = vacc)) +
   geom_bar()+
   labs(x = "Status of dogs being vaccinated.")
```

The majority of dog sale ads on gumtree do not specify whether the dog has been vaccinated or not. But when information is provided, more than 90% of dogs have been vaccinated.

### Desexing status
The variable  Desexing Status is a categorical variable.

#### Univariate plot
As  Desexing Status is a categorical variable, it can be visualised with a bar-chart (Fig. 6).
```{r, warning = F, error = F, fig.cap = "Figure 6: Bar-Chart of how many dogs have been desexed on gumtree."}
ggplot(gumtree, aes(x = desex, fill = desex)) +
   geom_bar()+
   labs(x = "Desex status of dogs.")
```

The majority of dog sale ads on gumtree do not specify whether the dog has been desexed. But when the information is provided, the majority of dogs have been desexed.

### Relinquished status
The variable  Relinquished Status is a categorical variable.

#### Univariate plot
As  Relinquished Status is a categorical variable, it can be visualised with a bar-chart (Fig. 7).
```{r, warning = F, error = F, fig.cap = "Figure 7: Bar-Chart of how many dogs have been relinquished on gumtree."}
ggplot(gumtree, aes(x = relinquished, fill = relinquished)) +
   geom_bar()+
   labs(x = "Relinquished status of dogs.")
```

The majority of dogs for sale on gumtree have been relinquished.


### Age

The variable Age is a numerical variable taking integer values.

#### Univariate Plot

```{r, warning = F, error = F}
ggplot(gumtree,aes(x = age)) +
  geom_histogram(ccol = "black", fill = "Light Blue") +
  labs(x = "Age of Dogs.")
```

# Bivariate Analysis

  
### Cross

```{r, warning = F, error = F, fig.cap = "Figure 8: Boxplots of dog prices on Gumtree sorted by cross"}
ggplot(gumtree, aes(x = cross, y = price)) + geom_boxplot()
```

#### Description

**Shape:**
The distribution of prices for dogs which are and are not been cross breeds appear to both be right-skeweed. Mean price seems to be slightly higher for breeds that are not crossed.

**Location:**
The centre of the data for dogs which are not been cross breeds is at a slightly higher price than those which are

**Spread:**
Prices of dogs which have been cross bred have a slightly wider spread of data than those which have not.

**Outliers:**
Both dogs which are cross breeds and those which are not have a large number of more extreme prices which can be considered to be outliers.


### Pet Offered By

Here we produce a boxplot for pets offered by owners and those offered by breeders against the response variable price:

```{r, warning = F, error = F, fig.cap = "Figure 1: Boxplots of dog prices on Gumtree sorted by seller"}
ggplot(gumtree, aes(x = `Pet Offered By:`, y = price)) + geom_boxplot()
```

We now produce the same plot but against the natural logarithm of price, since the interquartile range spanned a small portion of the price axis when the outliers are considered.

```{r, warning = F, error = F, fig.cap = "Figure 1.1: Boxplots of the natural logarithm of dog prices on Gumtree sorted by seller"}
ggplot(gumtree, aes(x = `Pet Offered By:`, y = log(price))) + geom_boxplot()
```

#### Description

**Shape:**
Both seem to be symmetrical aside from outliers, breeeder have a higher mean price compared to owner.

**Location:**
The data for dogs sold by breeders is centred at a higher price than those being sold by owners.

**Spread:**
There is a much wider range of prices of dogs sold by breeders than those sold by owners.

**Outliers:**
There are a number of outliers well above the majority of the prices for dogs sold by owners, most likely special breeds, and six outliers sold by breeders.


### Microchipping Status

Here we produce a boxplot for pets offered by owners and those offered by breeders against the response variable price:

```{r, warning = F, error = F, fig.cap = "Figure 2: Boxplots of dog prices on Gumtree sorted by whether dogs have been microchipped"}
ggplot(gumtree, aes(x = micro, y = price)) + geom_boxplot()
```

We can now filter out the NA values.

```{r, warning = F, error = F, fig.cap = "Figure 2.1: Boxplots of dog prices on Gumtree sorted by whether dogs have been microchipped, without NA values"}
ggplot(gumtree %>% filter(!is.na(gumtree$micro)), aes(x = micro, y = price)) + geom_boxplot()
```

Again, we produce the same plot but against the natural logarithm of price, since the interquartile range spanned a small portion of the price axis when the outliers are considered.

```{r, warning = F, error = F, fig.cap = "Figure 2.2: Boxplots of the natural logarithm of dog prices on Gumtree sorted by whether dogs have been microchipped, without NA values"}
ggplot(gumtree %>% filter(!is.na(gumtree$micro)), aes(x = micro, y = log(price))) + geom_boxplot()
```

#### Description

**Shape:**
Dogs which have been microchipped seem to have generally symmetrical data. Those which are not microchipped may be slightly right-skewed. Dogs that have been microchipped have a higher mean price compared to their counterpart.

**Location:**
The data for dogs which have been microchipped is centred at a slightly higher price than those which have not been microchipped, but there is some overlap.

**Spread:**
There is a much wider range of prices of dogs which have been microchipped than which have not been.

**Outliers:**
There is a large number of outliers for the dogs which have been microchiped. There are no outliers for the dogs which have not been microchipped.

### Vaccination

```{r, warning = F, error = F, fig.cap = "Figure 3: Boxplots of the dog prices on Gumtree sorted by whether dogs have been vaccinated"}
ggplot(gumtree, aes(x = vacc, y = price)) + geom_boxplot()
```

Without NA values:

```{r, warning = F, error = F, fig.cap = "Figure 3.1: Boxplots of the dog prices on Gumtree sorted by whether dogs have been vaccinated, without NA values"}
ggplot(gumtree %>% filter(!is.na(gumtree$vacc)), aes(x = vacc, y = price)) + geom_boxplot()
```

Again, we produce the same plot but against the natural logarithm of price, since the interquartile range spanned a small portion of the price axis when the outliers are considered.

```{r, warning = F, error = F, fig.cap = "Figure 3.2: Boxplots of the natural logarithm of dog prices on Gumtree sorted by whether dogs have been vaccinated, without NA values"}
ggplot(gumtree %>% filter(!is.na(gumtree$vacc)), aes(x = vacc, y = log(price))) + geom_boxplot()
```

#### Description

**Shape:**
Both dogs which have and which have not been vaccinated appear to have symmetrical data, however, since those which have not, have such a narrow spread, (possibly due to a small sample size) it is difficult to be certain. Vaccinated dogs have a higher mean price.

**Location:**
The centre of the data for dogs which have not been vaccinated is at a lower price than those which have.

**Spread:**
Those which have been vaccanited have a reasonably small spread apart from outliers, and those which have not been vaccinated have a very small spread.

**Outliers:**
The non-vaccinated dogs appear to have one outlier either side of the centre, and the dogs which have been vaccinated have a larger number of oultiers at prices much higher than the centre of the data.

### Desexing Status
  
```{r, warning = F, error = F, fig.cap = "Figure 4: Boxplots of the dog prices on Gumtree sorted by whether dogs have been desexed"}
ggplot(gumtree, aes(x = desex, y = price)) + geom_boxplot()
```

Without NA values:

```{r, warning = F, error = F, fig.cap = "Figure 4.1: Boxplots of the dog prices on Gumtree sorted by whether dogs have been vaccinated, without NA values"}
ggplot(gumtree %>% filter(!is.na(gumtree$desex)), aes(x = desex, y = price)) + geom_boxplot()
```

Again, we produce the same plot but against the natural logarithm of price, since the interquartile range spanned a small portion of the price axis when the outliers are considered.

```{r, warning = F, error = F, fig.cap = "Figure 4.2: Boxplots of the natural logarithm of dog prices on Gumtree sorted by whether dogs have been desexed, without NA values"}
ggplot(gumtree %>% filter(!is.na(gumtree$desex)), aes(x = desex, y = log(price))) + geom_boxplot()
```

#### Description

**Shape:**
The prices of dogs which have been desexed appears to be symmetrically distributed, while the prices of those which are entire appears to be somewhat right-skewed. Mean price of dogs is slightly higher for dogs that have been entired.

**Location:**
The data for the dogs which have not been desexed is centred a slightly higher price than those which have been desexed, but the difference is only approximately $100.

**Spread:**
The range of prices for the entire dogs is significantly larger than that for the desexed gods, which have quite a narrow spread.

**Outliers:**
There are a number of outliers in the prices of dogs which have been desexed, whereas there are only two outliers in the prices of dogs which have not been desexed.


### State

```{r, warning = F, error = F, fig.cap = "Figure 5: Boxplots of the dog prices on Gumtree sorted by state"}
ggplot(gumtree, aes(x = state, y = price)) + geom_boxplot()
```

Without NA values:

```{r, warning = F, error = F, fig.cap = "Figure 5.1: Boxplots of the dog prices on Gumtree sorted by state, without NA values"}
ggplot(gumtree %>% filter(!is.na(gumtree$state)), aes(x = state, y = price)) + geom_boxplot()
```

Again, we produce the same plot but against the natural logarithm of price, since the interquartile range spanned a small portion of the price axis when the outliers are considered.

```{r, warning = F, error = F, fig.cap = "Figure 5.2: Boxplots of the natural logarithm of dog prices on Gumtree sorted by state, without NA values"}
ggplot(gumtree %>% filter(!is.na(gumtree$state)), aes(x = state, y = log(price))) + geom_boxplot()
```

#### Description

**Shape:**
The distribution of prices of dogs seem to be mostly symmetrical in all states, except the prices in Victoria may be slightly right-skewed.

**Location:**
The centre of the data for dogs prices is very similar amongst all states.

**Spread:**
Most states have a smilarly small spread of data, except Victoria which has a wider spread, and ACT and WA which both have narrower spreads.

**Outliers:**
All states appear to have a number of outliers, with the least extreme prices in Tasmania. Most outliers seem to be skewed towards a higher price.

  

### Relinquished

```{r, warning = F, error = F, fig.cap = "Figure 6: Boxplots of the dog prices on Gumtree sorted by whether dogs have been relinquished"}
ggplot(gumtree, aes(x = relinquished, y = price)) + geom_boxplot()
```

Again, we produce the same plot but against the natural logarithm of price, since the interquartile range spanned a small portion of the price axis when the outliers are considered.

```{r, warning = F, error = F, fig.cap = "Figure 7: Boxplots of the natural logarithm of dog prices on Gumtree sorted by relinquished"}
ggplot(gumtree %>% filter(!is.na(gumtree$state)), aes(x = relinquished, y = log(price))) + geom_boxplot()
```

#### Description

**Shape:**
The distribution of prices for dogs which have and have not been relinquished appear to both be approximately symmetrical. Mean price is slightly higher for dogs which have not been relinquished.

**Location:**
The centre of the data for dogs which have not been relinquished is at a slightly higher price than those which have.

**Spread:**
Both those dogs which have and which have not been relinquished have a similarly narrow spread of prices.

**Outliers:**
Both dogs which have been relinquished and those which have not have a large number of more extreme prices which can be considered to be outliers.

### Age

```{r, warning = F, error = F, fig.cap = "Figure 7: Scatterplot of the dog prices of Gumtree against the age of the dog"}
ggplot(gumtree, aes(x = age, y = price)) + geom_point()
```

#### Description

**Linearity:**
The relationship between age and price does not seem to be at all linear.

**Direction**
The relationship appears to be negative (higher age corresponds to lower prices).

**Strength**
There is a large spread of data, so the strength of the relationship is weak to moderate.


Since the data does not appear at all linear, we can produce the same plot but with the natural logarithm of price:

```{r, warning = F, error = F, fig.cap = "Figure 7: Scatterplot of the natural logarithm of dog prices of Gumtree against the age of the dog"}
ggplot(gumtree, aes(x = age, y = log(price))) + geom_point()
```


# Model Fitting

We  define a version of the gumtree dataset (gumtreeN) without NA values in order to create our linear model.
```{r}

gumtreeN <- na.omit(gumtree)
gumtreeN <- filter(gumtreeN, price >10)

```

First, we create bivariate regression models of price against each predictor variable, to decide whether they have enough of an effect on price individually, and if not, they will not be considered for the final model. For this initial selection process, we use a more relaxed significance level of 0.1, before during model selection, where the stricter significance level of 0.05 is used.

Modelling against age:

```{r}
age.lm <- lm(price ~ age, data = gumtreeN)
glance(age.lm)
```

The p-value is less than the significance level of 0.1, hence the age data should be considered for the final model.

Modelling against cross:

```{r}
cross.lm <- lm(price ~ cross, data = gumtreeN)
glance(cross.lm)
```

The p-value is less than the significance level of 0.1, hence the cross data should be considered for the final model.

Modelling against microchipping status:

```{r}
micro.lm <- lm(price ~ micro, data = gumtreeN)
glance(micro.lm)
```

The p-value is greater than the significance level of 0.1, hence the microscipping status data need not be considered for the final model.

Modelling against vaccination:

```{r}
vacc.lm <- lm(price ~ vacc, data = gumtreeN)
glance(vacc.lm)
```

The p-value is greater than the significance level of 0.1, hence the vaccination status data need not be considered for the final model.

Modelling against desexing status:

```{r}
desex.lm <- lm(price ~ desex, data = gumtreeN)
glance(desex.lm)
```

The p-value is less than the significance level of 0.1, hence the desexing status data should be considered for the final model.

Modelling against whether or not the dog is relinquished:

```{r}
relinquished.lm <- lm(price ~ relinquished, data = gumtreeN)
glance(relinquished.lm)
```

The p-value is less than the significance level of 0.1, hence the relinquished data should be considered for the final model.

Modelling against the state in which state the dog is being sold:

```{r}
state.lm <- lm(price ~ state, data = gumtreeN)
glance(state.lm)
```

The p-value is greater than the significance level of 0.1, hence the state data need not be considered for the final model.


### Model Selection


First, we create full and smallest versions of the model to indicate the scope, or rather, the most and least detailed versions of the model:
```{r}

full <-  price ~ (age + cross + desex + relinquished)^2
smallest <- price ~ 1

```

Next, three different algorithms will be used to determine the model, and the results will be compared in order to decide upon the final model:

First, the backwards selection method is used:

```{r, include = FALSE}
options(width = 150)
bM <- lm(full, data = gumtreeN)
bM <- step(bM, direction = "backward")
```

```{r}
tidy(bM)
```

Next, the forwards selection method is used:
```{r, include = FALSE}
options(width = 150)
fM <- lm(smallest, data = gumtreeN)
fM <- step(fM, scope = full, direction = "forward")
```

```{r}
tidy(fM)
```

Finally, the stepwise selection method is used:
```{r, include = FALSE}
options(width = 150)
sM <- lm(smallest, data = gumtreeN)
sM <- step(sM, scope = full, direction = "both")
```

```{r}
tidy(sM)
```

Here are our 3 models. Notice that they are basically the same model. Age:Cross and Cross:Age interactions terms are essentially the same.  

```{r}
list(backwards = bM,
     forwards = fM,
     step = sM) %>%
  map_df(broom::tidy, .id = "Model") %>%
  select(Model, term, estimate) %>%
  spread(Model, estimate)
```

Let's check our assumptions for this model. We will call it test_model. 

```{r}
test_model<-sM
glance(test_model)
tmp<-par(mfrow=c(2,2))
plot(test_model)
```

Linearity: Check residual vs fitted plot.  If assumption is true we expect the red line to be flat around 0. We see that there is a bit of curvature but it's not too bad. Hence linearity is reasonable. 

Normality: Check normal QQ plot. If assumption is true we expect the points between -2 and 2 to fall on the diagonal line. We see that most points fall on the diagonal although some points curve upward around 2. Normality is ok. 

Equal variance: Check scale location plot. Looking for even spread as we go left to right.Points seem to fan outward as you go from left to right. Equal variance is not reasonable. 

Independence: Plots do not help. Price of dogs should theoretically be independent. 

Notice in the residual vs fitted plot, the points tend to be clustered to the left. This suggests that data is right skewed. Perhaps we can get a better model with a log transform of price. We apply the 3 algorithms we used previously. 



### Logarithm of Price

First, we create bivariate regression models of log(price) against each predictor variable, to decide whether they have enough of an effect on log(price) individually, and if not, they will not be considered for the final model. Again, for this initial selection process, we use a more relaxed significance level of 0.1, before during model selection, where the stricter significance level of 0.05 is used.

Modelling against age:
  
```{r}
log_age.lm <- lm(log(price) ~ age, data = gumtreeN)
glance(log_age.lm)
```
The p-value is less than the significance level of 0.1, hence the age data should be considered for the final logarithm model.

Modelling against cross:
  
```{r}
log_cross.lm <- lm(log(price) ~ cross, data = gumtreeN)
glance(log_cross.lm)
```
The p-value is less than the significance level of 0.1, hence the cross data should be considered for the final logarithm model.

Modelling against microchipping status:
  
```{r}
log_micro.lm <- lm(log(price) ~ micro, data = gumtreeN)
glance(log_micro.lm)
```

The p-value is greater than the significance level of 0.1, hence the microshipping status data need not be considered for the final logarithm model.

Modelling against vaccination:
  
```{r}
log_vacc.lm <- lm(log(price) ~ vacc, data = gumtreeN)
glance(log_vacc.lm)
```

The p-value is greater than the significance level of 0.1, hence the vaccination status data need not be considered for the final logarithm model.

Modelling against desexing status:
  
```{r}
log_desex.lm <- lm(log(price) ~ desex, data = gumtreeN)
glance(log_desex.lm)
```

The p-value is less than the significance level of 0.1, hence the desexing status data should be considered for the final logarithm model.

Modelling against whether or not the dog is relinquished:
  
```{r}
log_relinquished.lm <- lm(log(price) ~ relinquished, data = gumtreeN)
glance(log_relinquished.lm)
```

The p-value is greater than the significance level of 0.1, hence the relinquished data should be considered for the final logarithm model.

Modelling against the state in which state the dog is being sold:
  
```{r}
log_state.lm <- lm(log(price) ~ state, data = gumtreeN)
glance(log_state.lm)
```

The p-value is greater than the significance level of 0.1, hence the state data need not be considered for the final logarithm model.




Backward Model:

```{r, include = FALSE}
  log_full <-  log(price) ~ (age + cross + desex + relinquished)^2
  smallest <- log(price) ~ 1
  
  options(width = 150)
  log_bM <- lm(log_full, data = gumtreeN)
  log_bM <- step(log_bM, direction = "backward")
```

```{r}
  tidy(log_bM)
```

Forward Model: 
```{r, include = FALSE}
 options(width = 150)
  log_fM <- lm(log_full, data = gumtreeN)
  log_fM <- step(log_bM, direction = "forward")
```

```{r}
  tidy(log_bM)
```

Stepwise Model:

```{r, include = FALSE}
 options(width = 150)
  log_sM <- lm(log_full, data = gumtreeN)
  log_sM <- step(log_bM, direction = "both")
```

```{r}
  tidy(log_bM)
```

Let's put the 3 models next to each other. Notice that they are the same. Let's call this model log_model.

```{r}
list(backwards = log_bM,
     forwards = log_fM,
     step = log_sM) %>%
  map_df(broom::tidy, .id = "Model") %>%
  select(Model, term, estimate) %>%
  spread(Model, estimate)
```

Let's check our assumptions. 
```{r}
log_model<-log_sM
glance(log_model)
tmp<-par(mfrow=c(2,2))
plot(log_model)

```

Linearity: Check residual vs fitted plot.  If assumption is true we expect the red line to be flat around 0. We see that there is a bit of curvature but it's not too bad. Hence linearity is reasonable. 

Normality: Check normal QQ plot. If assumption is true we expect the points between -2 and 2 to fall on the diagonal line. We see that most points fall on the diagonal. Normality is ok and much better than previous model. 

Constant variance: Check scale location plot. Looking for even spread as we go left to right.Some curvature is seen but is not too bad. Better than previous model. Equal variance is ok.

Independence: Plots do not help. Price of dogs should theoretically be independent. 

Given that the 4 assumptions are ok and the plots for the log model look better, we will go with the log model. 


# Prediction
**This is not final as model selection is unfinished, but the code seems to work**
```{r}
predict(log_bM, data.frame(state = "SA", cross = "yes", age = 1, vacc = "vaccinated",
                       relinquished = "yes", desex = "Desexed",
                       micro = "microchipped"), interval = "predict")
```

We were asked to predict the price of a South Australian, cross-breed dog that is 1 year old. The dog is vaccinated, desexed and unfortunately has to be re-homed because the owner is moving interstate. we will use our log model which only uses the predictors, age, cross, desex and relinquished. 

Based on our model the log price of the dog is 4.571763. 

```{r}
exp(4.571763)
```

Hence the predicted price for this dog is $96.71. That is to say our model predicts that the median price for a dog of the traits above is $96.71. 

Reference:

All code for this paper is openly available on github in the r markdown file. The relevant code can be found in the .rmd document.

https://github.com/Noramia/Gumtree-dogs
